<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ONNX Benchmark: onnxruntime-web vs jax-js WebGPU</title>
    <style>
      * { box-sizing: border-box; }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #1a1a1a;
        color: #e0e0e0;
      }
      h1 { color: #fff; margin-bottom: 8px; }
      .subtitle { color: #888; margin-bottom: 24px; }
      .config {
        background: #252525;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .config label { display: block; margin-bottom: 12px; }
      .config input {
        width: 100px;
        padding: 6px;
        margin-left: 8px;
        background: #333;
        border: 1px solid #444;
        color: #fff;
        border-radius: 4px;
      }
      button {
        background: #4a9eff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 20px;
      }
      button:hover { background: #3a8eef; }
      button:disabled { background: #555; cursor: not-allowed; }
      #log {
        background: #0d0d0d;
        padding: 16px;
        border-radius: 8px;
        font-family: 'SF Mono', Monaco, monospace;
        font-size: 13px;
        line-height: 1.5;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 20px;
      }
      .results {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }
      .result-card {
        background: #252525;
        padding: 20px;
        border-radius: 8px;
      }
      .result-card h3 { margin: 0 0 16px 0; }
      .result-card.onnxruntime h3 { color: #ff9f43; }
      .result-card.jaxjs h3 { color: #a55eea; }
      .stat {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #333;
      }
      .stat:last-child { border-bottom: none; }
      .stat-label { color: #888; }
      .stat-value { color: #fff; font-family: 'SF Mono', Monaco, monospace; }
      .comparison {
        background: #252525;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
      }
      .comparison .winner {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 8px;
      }
      .comparison .winner.onnxruntime { color: #ff9f43; }
      .comparison .winner.jaxjs { color: #a55eea; }
      .comparison .speedup { color: #888; }
      .bar-chart { margin-top: 20px; }
      .bar-row { display: flex; align-items: center; margin-bottom: 12px; }
      .bar-label { width: 140px; font-size: 14px; }
      .bar-container {
        flex: 1;
        height: 24px;
        background: #333;
        border-radius: 4px;
        overflow: hidden;
      }
      .bar { height: 100%; border-radius: 4px; transition: width 0.3s ease; }
      .bar.onnxruntime { background: #ff9f43; }
      .bar.jaxjs { background: #a55eea; }
      .bar-value {
        width: 80px;
        text-align: right;
        font-family: 'SF Mono', Monaco, monospace;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <h1>ONNX Inference Benchmark</h1>
    <p class="subtitle">onnxruntime-web vs jax-js (WebGPU)</p>

    <div class="config">
      <label>
        Warmup iterations:
        <input type="number" id="warmup" value="50" min="1" />
      </label>
      <label>
        Benchmark iterations:
        <input type="number" id="iterations" value="500" min="10" />
      </label>
    </div>

    <button id="run-btn">Run Benchmark</button>

    <div id="log"></div>

    <div id="results-container" style="display: none;">
      <div class="results">
        <div class="result-card onnxruntime">
          <h3>onnxruntime-web</h3>
          <div class="stat">
            <span class="stat-label">Average</span>
            <span class="stat-value" id="ort-avg">-</span>
          </div>
          <div class="stat">
            <span class="stat-label">Min</span>
            <span class="stat-value" id="ort-min">-</span>
          </div>
          <div class="stat">
            <span class="stat-label">Max</span>
            <span class="stat-value" id="ort-max">-</span>
          </div>
          <div class="stat">
            <span class="stat-label">Throughput</span>
            <span class="stat-value" id="ort-throughput">-</span>
          </div>
        </div>

        <div class="result-card jaxjs">
          <h3>jax-js (WebGPU)</h3>
          <div class="stat">
            <span class="stat-label">Average</span>
            <span class="stat-value" id="jax-avg">-</span>
          </div>
          <div class="stat">
            <span class="stat-label">Min</span>
            <span class="stat-value" id="jax-min">-</span>
          </div>
          <div class="stat">
            <span class="stat-label">Max</span>
            <span class="stat-value" id="jax-max">-</span>
          </div>
          <div class="stat">
            <span class="stat-label">Throughput</span>
            <span class="stat-value" id="jax-throughput">-</span>
          </div>
        </div>
      </div>

      <div class="comparison">
        <div class="winner" id="winner">-</div>
        <div class="speedup" id="speedup">-</div>
      </div>

      <div class="bar-chart">
        <div class="bar-row">
          <div class="bar-label">onnxruntime-web</div>
          <div class="bar-container">
            <div class="bar onnxruntime" id="ort-bar" style="width: 0%"></div>
          </div>
          <div class="bar-value" id="ort-bar-value">-</div>
        </div>
        <div class="bar-row">
          <div class="bar-label">jax-js (WebGPU)</div>
          <div class="bar-container">
            <div class="bar jaxjs" id="jax-bar" style="width: 0%"></div>
          </div>
          <div class="bar-value" id="jax-bar-value">-</div>
        </div>
      </div>
    </div>

    <script type="module">
      import { runBenchmark } from './src/benchmark-onnx.ts'

      const logEl = document.getElementById('log')
      const runBtn = document.getElementById('run-btn')
      const resultsContainer = document.getElementById('results-container')

      function log(message) {
        logEl.textContent += message + '\n'
        logEl.scrollTop = logEl.scrollHeight
      }

      function updateResults(onnxRuntime, jaxJsWebGpu) {
        resultsContainer.style.display = 'block'

        document.getElementById('ort-avg').textContent = onnxRuntime.avgTimeMs.toFixed(3) + ' ms'
        document.getElementById('ort-min').textContent = onnxRuntime.minTimeMs.toFixed(3) + ' ms'
        document.getElementById('ort-max').textContent = onnxRuntime.maxTimeMs.toFixed(3) + ' ms'
        document.getElementById('ort-throughput').textContent =
          onnxRuntime.throughputInferencesPerSec.toFixed(1) + ' /sec'

        document.getElementById('jax-avg').textContent = jaxJsWebGpu.avgTimeMs.toFixed(3) + ' ms'
        document.getElementById('jax-min').textContent = jaxJsWebGpu.minTimeMs.toFixed(3) + ' ms'
        document.getElementById('jax-max').textContent = jaxJsWebGpu.maxTimeMs.toFixed(3) + ' ms'
        document.getElementById('jax-throughput').textContent =
          jaxJsWebGpu.throughputInferencesPerSec.toFixed(1) + ' /sec'

        const speedup = onnxRuntime.avgTimeMs / jaxJsWebGpu.avgTimeMs
        const winnerEl = document.getElementById('winner')
        const speedupEl = document.getElementById('speedup')

        if (speedup > 1) {
          winnerEl.textContent = 'jax-js WebGPU wins!'
          winnerEl.className = 'winner jaxjs'
          speedupEl.textContent = `${speedup.toFixed(2)}x faster than onnxruntime-web`
        } else {
          winnerEl.textContent = 'onnxruntime-web wins!'
          winnerEl.className = 'winner onnxruntime'
          speedupEl.textContent = `${(1 / speedup).toFixed(2)}x faster than jax-js`
        }

        const maxAvg = Math.max(onnxRuntime.avgTimeMs, jaxJsWebGpu.avgTimeMs)
        document.getElementById('ort-bar').style.width = (onnxRuntime.avgTimeMs / maxAvg) * 100 + '%'
        document.getElementById('jax-bar').style.width = (jaxJsWebGpu.avgTimeMs / maxAvg) * 100 + '%'
        document.getElementById('ort-bar-value').textContent = onnxRuntime.avgTimeMs.toFixed(2) + ' ms'
        document.getElementById('jax-bar-value').textContent = jaxJsWebGpu.avgTimeMs.toFixed(2) + ' ms'
      }

      runBtn.addEventListener('click', async () => {
        logEl.textContent = ''
        resultsContainer.style.display = 'none'
        runBtn.disabled = true
        runBtn.textContent = 'Running...'

        try {
          const warmup = parseInt(document.getElementById('warmup').value, 10)
          const iterations = parseInt(document.getElementById('iterations').value, 10)

          const { onnxRuntime, jaxJsWebGpu } = await runBenchmark({
            warmupIterations: warmup,
            benchmarkIterations: iterations,
            onProgress: log,
          })

          updateResults(onnxRuntime, jaxJsWebGpu)
        } catch (e) {
          log('Error: ' + e.message)
          console.error(e)
        } finally {
          runBtn.disabled = false
          runBtn.textContent = 'Run Benchmark'
        }
      })
    </script>
  </body>
</html>
